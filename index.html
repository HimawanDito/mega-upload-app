<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MEGA PRO Upload</title>

<script src="https://cdn.jsdelivr.net/npm/megajs@1.1.3/dist/main.browser-umd.js"></script>

<style>
body{
font-family:Arial;
background:#020617;
color:white;
padding:20px;
}

.card{
background:#0f172a;
padding:20px;
border-radius:16px;
max-width:500px;
margin:auto;
}

.drop{
border:2px dashed #38bdf8;
padding:20px;
text-align:center;
margin-top:15px;
border-radius:10px;
}

.file{
margin-top:10px;
background:#020617;
padding:10px;
border-radius:10px;
}

.bar{
height:6px;
background:#22c55e;
width:0%;
margin-top:5px;
border-radius:10px;
}
</style>
</head>

<body>

<div class="card">

<h2>‚òÅÔ∏è MEGA PRO UPLOADER</h2>

<h4>Akun 1</h4>
<input id="email1" placeholder="Email">
<input id="pass1" type="password" placeholder="Password">

<h4>Akun 2</h4>
<input id="email2" placeholder="Email">
<input id="pass2" type="password" placeholder="Password">

<button onclick="loginAll()">LOGIN SEMUA</button>

<div class="drop" id="drop">
üìÇ Drag & Drop File di sini
</div>

<input type="file" id="files" multiple>

<div id="list"></div>

</div>

<script>

let mega1, mega2;

function saveSession(key,data){
localStorage.setItem(key,JSON.stringify(data));
}

function getSession(key){
return JSON.parse(localStorage.getItem(key));
}

function loginAll(){

mega1 = new Mega({
email:email1.value,
password:pass1.value,
keepalive:true
});

mega2 = new Mega({
email:email2.value,
password:pass2.value,
keepalive:true
});

mega1.on('ready',()=>console.log("MEGA1 OK"));
mega2.on('ready',()=>console.log("MEGA2 OK"));
}

function getType(file){

let ext = file.name.split('.').pop().toLowerCase();

if(["jpg","png","jpeg","webp"].includes(ext)) return "foto";
if(["mp4","mkv","avi"].includes(ext)) return "video";
return "dokumen";
}

function targetMega(type){

if(type=="video") return mega2;
return mega1;
}

async function uploadFile(file){

let type = getType(file);
let mega = targetMega(type);

let folder = mega.root;

let div = document.createElement("div");
div.className="file";
div.innerHTML=file.name+"<div class='bar'></div>";

list.appendChild(div);

let bar = div.querySelector(".bar");

let up = folder.upload(file);

up.on('progress',p=>{
bar.style.width=(p*100)+"%";
});

await new Promise(res=>up.on('complete',res));
}

function handleFiles(files){
[...files].forEach(uploadFile);
}

files.onchange = e=>handleFiles(e.target.files);

drop.ondragover = e=>{
e.preventDefault();
};

drop.ondrop = e=>{
e.preventDefault();
handleFiles(e.dataTransfer.files);
};

</script>

</body>
</html>
